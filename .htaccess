RewriteEngine On

# Security: Disable directory listing
Options -Indexes

# Security: Protect sensitive files from direct browser access
# Note: PHP can still include/require these files
<Files "config.php">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</Files>

<Files ".env">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</Files>

# Force HTTPS (uncomment when SSL is configured)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Get the base path dynamically (works for both subdirectory and root)
RewriteCond %{REQUEST_URI}::$1 ^(.*?/)(.*)::\2$
RewriteRule ^(.*)$ - [E=BASE:%1]

# Redirect all API requests to api/index.php
# Works whether project is in root or subdirectory
RewriteCond %{REQUEST_URI} ^(.*/)?api/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^api/(.*)$ api/index.php?path=$1 [QSA,L]

# Optional: Redirect root to API docs or frontend
# RewriteRule ^$ index.html [L]



